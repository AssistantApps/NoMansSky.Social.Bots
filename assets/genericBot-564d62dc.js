var F=Object.defineProperty;var G=(t,r,a)=>r in t?F(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var N=(t,r,a)=>(G(t,typeof r!="symbol"?r+"":r,a),a);import{c as e,G as j,S as H,B as z,C as J,a as h,N as c,b as V,o as I,I as q,t as w,D as Q,d as l,H as R,e as K,s as C,i as B,f as U,g as W,h as X,j as y,k as b,l as m,L as Y,U as Z,m as ee,n as te,p as M,M as D,q as ne,r as _,u as re,V as ae,v as P,w as se,x as A,y as oe,z as ie,A as ce,E,J as le,K as ue,O as de,P as ge,Q as he,R as me,T as pe}from"./index-734364e3.js";import{P as fe}from"./pageHeader-f1d8187d.js";const Se=t=>e(j,{gap:"$4",templateColumns:"repeat(4, 1fr)",width:"100%",get children(){return t.children}});var ve=Object.defineProperty,be=Object.getOwnPropertyDescriptor,we=(t,r,a,n)=>{for(var s=n>1?void 0:n?be(r,a):r,o=t.length-1,i;o>=0;o--)(i=t[o])&&(s=(n?i(r,a,s):i(s))||s);return n&&s&&ve(r,a,s),s};let $=class extends z{constructor(){super("https://nomanssky.social/api");N(this,"getConversations",r=>this.get("v1/conversations",()=>({headers:{Authorization:`Bearer ${r}`}})))}};$=we([H()],$);const Ce=()=>J.get($),ye=w("<span>✉</span>"),Me=t=>{h(c.Loading);const[r,a]=h(V);I(()=>{const s=Ce();a(s)});const n=async s=>{const i=await r().getConversations(s.accessToken);console.log({convos:i})};return e(q,{colorScheme:"warning","aria-label":"Close drawer",borderRadius:"2em",class:"message-icon",onClick:()=>n(t.botMeta),get icon(){return ye.cloneNode(!0)}})},k=()=>e(l,{pt:"1.5em",colSpan:{"@initial":"4","@lg":"2"},display:{"@initial":"unset","@lg":"none"},get children(){return e(Q,{})}}),_e=()=>e(l,{colSpan:4,get children(){return e(R,{children:"Hi"})}}),$e={dialogJson:"https://github.com/AssistantApps/NoMansSky.Social.Bots/blob/main/src/assets/data/dialogs.json"},ke=w('<a target="_blank" rel="noopener noreferrer"></a>'),T="nmscdCommunitySearch",Be=t=>{const r=n=>n.includes("@")?n:n.includes("?")?n+`&ref=${T}`:n+`?ref=${T}`,a=n=>{t.onClick!=null&&(n.preventDefault(),t.onClick())};return(()=>{const n=ke.cloneNode(!0);return n.$$click=a,C(n,"draggable",!1),B(n,()=>t.children),U(s=>{var u;const o=t.id,i=r(t.href),p=(u=t.additionalClassNames)!=null?u:"";return o!==s._v$&&C(n,"id",s._v$=o),i!==s._v$2&&C(n,"href",s._v$2=i),p!==s._v$3&&W(n,s._v$3=p),s},{_v$:void 0,_v$2:void 0,_v$3:void 0}),n})()};K(["click"]);const xe=t=>{const[r,a]=h(c.Loading),[n,s]=h([]);I(()=>{o(t.botMeta.dialog)});const o=async i=>{const u=await X().getDialogFile();u.isSuccess==!1&&(y().e(t.botMeta.name,"Could not fetch github file",u.errorMessage),a(c.Error));const f=u.value[i];f!=null&&f.length>0&&(s(f),a(c.Success))};return[e(m,{get when(){return r()==c.Error},get children(){return e(b,{children:"Something went wrong"})}}),e(m,{get when(){return r()==c.Loading},get children(){return e(l,{colSpan:4,get children(){return e(b,{get children(){return e(Y,{})}})}})}}),e(m,{get when(){return r()==c.Success},get children(){return e(l,{colSpan:4,get children(){return[e(R,{children:"Current possible dialog options:"}),e(Z,{get children(){return e(ee,{get each(){return n()},children:i=>e(te,{get children(){return[M(()=>i.type)," - ",M(()=>i.message)]}})})}}),e(b,{mt:"1em",get children(){return e(Be,{get href(){return $e.dialogJson},children:"Edit the dialog options in the JSON file ↗"})}})]}})}})]},Le=t=>e(re,{get fallback(){return[]},get children(){return[e(D,{get when(){return ne().includes(t.botMeta.type)},get children(){return[e(xe,{get botMeta(){return t.botMeta}}),e(k,{})]}}),e(D,{get when(){return t.botMeta.type===_.qsCompanion},get children(){return[e(_e,{}),e(k,{})]}})]}}),Ne=w("<i></i>"),De=t=>(h(c.Pending),e(l,{colSpan:{"@initial":"4","@lg":"2"},get children(){return e(ae,{as:"form",spacing:"$5",alignItems:"stretch",get children(){return[e(P,{get children(){return[e(se,{get src(){return t.botMeta.imageUrl},get alt(){return t.botMeta.profileName},borderRadius:"10px",mt:"1em",maxH:"50px"}),e(A,{m:"10px"}),e(oe,{get children(){return[e(ie,{for:"message",get children(){return["Message to send as ",(()=>{const r=Ne.cloneNode(!0);return B(r,()=>t.botMeta.profileName),r})()]}}),e(ce,{id:"message",type:"text"})]}})]}}),e(P,{justifyContent:"flex-end",get children(){return e(E,{type:"submit",children:"Submit"})}})]}})}})),Pe=w('<div id="bot-timeline" class="mt-body" style="width: 100%"></div>'),Ae=()=>{const t=le(),r=ue(),a=de(ge),[n,s]=h(c.Loading),[o,i]=h();he(()=>{s(c.Loading),p()},[t.id]);const p=()=>{var L;y().i("initializePage");const d=a==null||a.accounts==null||a.accounts.length<1||a.apiAuthToken==null;let g=!1,v=_.unknown;try{const S=t.id;v=S,g=S==null||v==null||v===_.unknown}catch{g=!0}if(d||g){y().e("something went wrong",{invalidCreds:d,invalidBotType:g}),r(me.home,{replace:!0});return}const x=((L=a==null?void 0:a.accounts)!=null?L:[]).findIndex(S=>S.type===v);if(x<0)return;const O=a.accounts[x];i(O),s(c.Success)},u=d=>{if(d!=null)try{window.loadMasto({container_body_id:"bot-timeline",instance_uri:"https://nomanssky.social",user_id:d.userId,profile_name:d.profileName,toots_limit:5})}catch{}},f=d=>e(l,{"data-key":d,pt:"1.5em",colSpan:{"@initial":"4","@lg":"2"},get children(){const g=Pe.cloneNode(!0);return B(g,e(E,{colorScheme:"accent",width:"100%",onClick:()=>u(o()),children:"🐘 Display latest Toots!"})),g}});return e(Se,{get children(){return[e(m,{get when(){return n()==c.Error},get children(){return e(b,{children:"Something went wrong"})}}),e(m,{get when(){return n()==c.Loading},get children(){return e(l,{colSpan:4,get children(){return e(pe,{})}})}}),e(m,{get when(){return n()==c.Success},get children(){return[e(l,{colSpan:4,get children(){return e(fe,{get text(){return o().name}})}}),e(Me,{get botMeta(){return o()}}),e(Le,{get botMeta(){return o()}}),e(De,{get botMeta(){return o()}}),e(k,{}),M(()=>f(o().type)),e(l,{}),e(A,{m:"3em"})]}})]}})};export{Ae as GenericBotPage,Ae as default};
