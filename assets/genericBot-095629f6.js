var q=Object.defineProperty;var Q=(t,r,s)=>r in t?q(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var y=(t,r,s)=>(Q(t,typeof r!="symbol"?r+"":r,s),s);import{c as T,a as p,N as i,b as e,B as w,G as h,M as j,d as P,e as R,f as E,g as H,S as g,C as f,L as D,V as I,F as G,H as k,A as K,h as L,i as z,j as V,t as C,k as b,D as U,l as J,m as W,n as X,o as Y,p as Z,s as _,q as N,r as ee,u as te,v as ne,U as re,w as se,x as A,y as oe,z as $,E as ae,I as ie,J as ce,K as le,O as ue,P as de,Q as ge,R as he,T as me,W as fe,X as Se,Y as pe,Z as ve}from"./index-ad524b77.js";import{g as we,B as be,R as Ce}from"./mastodonApiService-2f1d2948.js";const Me=C("<div></div>"),ye=t=>{const{isOpen:r,onOpen:s,onClose:n}=T(),[o,a]=p(i.Loading),[c,S]=p([]),d=async l=>{a(i.Loading),s();const u=await we().getConversations(l.accessToken);u.isSuccess==!1&&(b().e(t.botMeta.name,"Could not fetch conversations",u.errorMessage),a(i.Error));const M=u.value;S(M),a(i.Success)};return[e(h,{get["data-key"](){return t.botMeta.type},pt:"1.5em",colSpan:2,get children(){return e(w,{colorScheme:"accent",width:"100%",onClick:()=>d(t.botMeta),children:"🐘 Display latest conversations!"})}}),e(V,{size:"4xl",get opened(){return r()},onClose:n,get children(){return[e(j,{}),e(P,{get children(){return[e(R,{}),e(E,{children:"Conversations"}),e(H,{get children(){return[e(g,{get when(){return o()==i.Error},get children(){return e(f,{children:"Something went wrong"})}}),e(g,{get when(){return o()==i.Loading},get children(){return e(f,{minH:"50vh",width:"100%",get children(){return e(D,{})}})}}),e(g,{get when(){return o()==i.Success},get children(){return e(g,{get when(){return c().length>0},get fallback(){return e(f,{children:"No Items"})},get children(){return e(I,{class:"conversations",justifyContent:"flex-start",alignItems:"flex-start",get children(){return e(G,{get each(){return c()},children:l=>{let m=l.last_status.content;for(const u of l.last_status.emojis)m=m.replaceAll(`:${u.shortcode}:`,`<img src="${u.static_url}" class="emoji" alt="${u.shortcode}" />`);return e(k,{class:"convo",get children(){return[e(K,{get src(){return l.last_status.account.avatar}}),e(L,{class:"content limit-height",ml:10,flexGrow:4,get children(){const u=Me.cloneNode(!0);return u.innerHTML=m,u}})]}})}})}})}})}})]}}),e(z,{get children(){return e(w,{onClick:n,children:"Close"})}})]}})]}})]},x=()=>e(h,{pt:"1.5em",colSpan:{"@initial":"4","@lg":"2"},display:{"@initial":"unset","@lg":"none"},get children(){return e(U,{})}}),_e=()=>e(h,{colSpan:4,get children(){return e(J,{children:"Hi"})}}),ke={dialogJson:"https://github.com/AssistantApps/NoMansSky.Social.Bots/blob/main/src/assets/data/dialogs.json"};var $e=Object.defineProperty,xe=Object.getOwnPropertyDescriptor,Be=(t,r,s,n)=>{for(var o=n>1?void 0:n?xe(r,s):r,a=t.length-1,c;a>=0;a--)(c=t[a])&&(o=(n?c(r,s,o):c(o))||o);return n&&o&&$e(r,s,o),o};let B=class extends be{constructor(){super("https://raw.githubusercontent.com");y(this,"getDialogFile",()=>this._getFile("/AssistantApps/NoMansSky.Social.Bots/main/src/assets/data/dialogs.json"));y(this,"getVersionFile",()=>this._getFile("/AssistantApps/NoMansSky.Social.Bots/main/public/assets/data/admin-version.json"))}async _getFile(r){const s=await this.get(r);return s.isSuccess?s:{...s,value:X}}};B=Be([W()],B);const De=()=>Y.get(B),Le=C('<a target="_blank" rel="noopener noreferrer"></a>'),F="nmscdCommunitySearch",Ne=t=>{const r=n=>n.includes("@")?n:n.includes("?")?n+`&ref=${F}`:n+`?ref=${F}`,s=n=>{t.onClick!=null&&(n.preventDefault(),t.onClick())};return(()=>{const n=Le.cloneNode(!0);return n.$$click=s,_(n,"draggable",!1),N(n,()=>t.children),ee(o=>{var d;const a=t.id,c=r(t.href),S=(d=t.additionalClassNames)!=null?d:"";return a!==o._v$&&_(n,"id",o._v$=a),c!==o._v$2&&_(n,"href",o._v$2=c),S!==o._v$3&&te(n,o._v$3=S),o},{_v$:void 0,_v$2:void 0,_v$3:void 0}),n})()};Z(["click"]);const Oe=t=>{const[r,s]=p(i.Loading),[n,o]=p([]);ne(()=>{a(t.botMeta.dialog)});const a=async c=>{const d=await De().getDialogFile();d.isSuccess==!1&&(b().e(t.botMeta.name,"Could not fetch github file",d.errorMessage),s(i.Error));const l=d.value[c];l!=null&&l.length>0&&(o(l),s(i.Success))};return[e(g,{get when(){return r()==i.Error},get children(){return e(f,{children:"Something went wrong"})}}),e(g,{get when(){return r()==i.Loading},get children(){return e(h,{colSpan:4,get children(){return e(f,{get children(){return e(D,{})}})}})}}),e(g,{get when(){return r()==i.Success},get children(){return e(h,{colSpan:4,get children(){return[e(J,{children:"Current possible dialog options:"}),e(re,{get children(){return e(G,{get each(){return n()},children:c=>e(se,{get children(){return c.message}})})}}),e(f,{mt:"1em",get children(){return e(Ne,{get href(){return ke.dialogJson},children:"Edit the dialog options in the JSON file ↗"})}})]}})}})]},Ae=t=>e(ae,{get fallback(){return[]},get children(){return[e(A,{get when(){return oe().includes(t.botMeta.type)},get children(){return[e(Oe,{get botMeta(){return t.botMeta}}),e(x,{})]}}),e(A,{get when(){return t.botMeta.type===$.qsCompanion},get children(){return[e(_e,{}),e(x,{})]}})]}}),Fe=t=>new Promise(r=>setTimeout(r,t)),Te=C('<div id="bot-timeline" class="mt-body" style="width: 100%"></div>'),je=t=>{const{isOpen:r,onOpen:s,onClose:n}=T(),o=async a=>{s(),await Fe(100);try{window.loadMasto({container_body_id:"bot-timeline",instance_uri:"https://nomanssky.social",user_id:a.userId,profile_name:a.profileName,toots_limit:5})}catch{}};return[e(h,{get["data-key"](){return t.botMeta.type},pt:"1.5em",colSpan:2,get children(){return e(w,{colorScheme:"accent",width:"100%",onClick:()=>o(t.botMeta),children:"🐘 Display latest Toots!"})}}),e(V,{size:"xl",get opened(){return r()},onClose:n,get children(){return[e(j,{}),e(P,{get children(){return[e(R,{}),e(E,{children:"Latest Toots!"}),e(H,{get children(){const a=Te.cloneNode(!0);return N(a,e(f,{minH:"50vh",width:"100%",get children(){return e(D,{})}})),a}}),e(z,{get children(){return e(w,{onClick:n,children:"Close"})}})]}})]}})]},Pe=C("<i></i>"),Re=t=>(p(i.Pending),e(h,{colSpan:{"@initial":"4","@lg":"2"},get children(){return e(I,{as:"form",spacing:"$5",alignItems:"stretch",get children(){return[e(k,{get children(){return[e(ie,{get src(){return t.botMeta.imageUrl},get alt(){return t.botMeta.profileName},borderRadius:"10px",mt:"1em",maxH:"50px"}),e(L,{m:"10px"}),e(ce,{get children(){return[e(le,{for:"message",get children(){return["Message to send as ",(()=>{const r=Pe.cloneNode(!0);return N(r,()=>t.botMeta.profileName),r})()]}}),e(ue,{id:"message",type:"text"})]}})]}}),e(k,{justifyContent:"flex-end",get children(){return e(w,{type:"submit",children:"Submit"})}})]}})}})),Ge=()=>{const t=de(),r=ge(),s=he(me),[n,o]=p(i.Loading),[a,c]=p();fe(()=>{o(i.Loading),S()},[t.id]);const S=()=>{var O;b().i("initializePage");const d=s==null||s.accounts==null||s.accounts.length<1||s.apiAuthToken==null;let l=!1,m=$.unknown;try{const v=t.id;m=v,l=v==null||m==null||m===$.unknown}catch{l=!0}if(d||l){b().e("something went wrong",{invalidCreds:d,invalidBotType:l}),r(Se.home,{replace:!0});return}const u=((O=s==null?void 0:s.accounts)!=null?O:[]).findIndex(v=>v.type===m);if(u<0)return;const M=s.accounts[u];c(M),o(i.Success)};return e(Ce,{get children(){return[e(g,{get when(){return n()==i.Error},get children(){return e(f,{children:"Something went wrong"})}}),e(g,{get when(){return n()==i.Loading},get children(){return e(h,{colSpan:4,get children(){return e(pe,{})}})}}),e(g,{get when(){return n()==i.Success},get children(){return[e(h,{colSpan:4,get children(){return e(ve,{get text(){return a().name}})}}),e(Ae,{get botMeta(){return a()}}),e(Re,{get botMeta(){return a()}}),e(x,{}),e(je,{get botMeta(){return a()}}),e(ye,{get botMeta(){return a()}}),e(h,{}),e(L,{m:"3em"})]}})]}})};export{Ge as GenericBotPage,Ge as default};
